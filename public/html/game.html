<!DOCTYPE html>
<html>
<head>
    <title>Serious Game by Moritz Rohde</title>
    <link rel="stylesheet" type="text/css" href="public/stylesheets/game_style.css">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

</head>
<body>

    <div id="content">
        <span id="canvas_content_container"></span>

        <div id="story_telling_div" onclick="hide_story_text()">
            <p id="story_telling_p"></p>
            <p>Klicken zum Fortfahren</p>
        </div>



        <div id="card_div">
            <div id="current_player_and_cube_div">
                <img id="cube_img" src="./public/images/dice_one.png" onclick="roll_the_dice()">
                <span id="current_player_name_span">Aktueller Spieler:</span>
                <br>
                <span id="current_player_name_label"></span>
            </div>

            <div id="card_content">
                <div id="image_div">
                    <img id="card_image" src="./public/images/blank.jpg" alt="Image">
                </div>

            </div>
            <div id="card_bottom">
                <!--<label id="card_text" onclick="executeCardAction(currentActionCard);"></label>-->
                <label id="card_text" onclick="executeCardAction(currentActionCard);"></label>
            </div>
        </div>
        <div id='test_div'>
            <p class='test_p'>Link zum Post Test:</p>
            <a id='test_link' href='https://www.survio.com/survey/d/F2O3Y8A4F8W3G2C3V'>https://www.survio.com/survey/d/F2O3Y8A4F8W3G2C3V</a>
            <br>
            <button onclick="toGoal(38)">38</button>
			<p class='test_p'>Oder den QR-Code scannen (Handy Kamera), um zum Post Test zu gelangen:</p>
			<br>
			<img id='qr_code' src='./public/images/post_test_code.png'>
        </div>

    </div>



    <script>
        var config = {
            type: Phaser.AUTO,
            width: 1200,
            height: 800,
            parent: 'canvas_content_container',
            title: 'MyGame',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 100 }
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };


        //Quelle: animography.net
        //Action GIF
        const ACTION_GIF_FROZEN = './public/images/action_card_frozen.jpg';
        //Knowledge GIF
        const  KNOWLEDGE_GIF_FROZEN = './public/images/knowledge_card_frozen.jpg';
        const EMPTY_FIELD_IMG = './public/images/blank.jpg';
        //Winner GIF
        const FIRST_IMAGE = './public/images/first.png';
        const SECOND_IMAGE = './public/images/second.png';
        const THIRD_IMAGE = './public/images/third.png';

        //var objects = {};
        let game = new Phaser.Game(config);

        //All game field positions
        let gamefield_positions;

        //game field type list
        let gamefield_types;

        // List of all Knowledge Cards
        let knowledge_cards;

        // List of all Action cards - reality near story
        let action_cards_real;

        // List of all Action cards - fictitious story
        let action_cards_fictitious;

        //public var for steps to go
        let steps = 0;

        //public print x and y values - Start position
        var_print_x = 250;
        var_print_y = 250;

        //game is busy like moving
        let ready = true;

        //game story type
        let story_type = '';

        //Player variables
        let currentPlayer;
        let currentPlayerPos = -1;
        let playerList = [];
        let winnerList = [];

        //Constants
        const CARD_ID = 'card_image';
        const CARD_TEXT_ID = 'card_text';


        const FIRST_FIELD_TEXT_REAL = 'Du hast als Erster alles über das Präsentieren gelernt. Damit bist du deinen Mitbewerbern voraus und bekommst den besten Job! Herzlichen Glückwunsch.';
        const SECOND_FIELD_TEXT_REAL = 'Du hast als Zweiter alles über das Präsentieren gelernt. Du bist zwar nicht der Beste und hast den ersten Job nicht bekommen. Doch dank deiner Fähigkeiten hast du direkt ein neues Angebot bekommen. Hertlichen Glückwunsch';
        const THIRD_FIELD_TEXT_REAL = 'Du hast als Dritter alles über das Präsentieren gelernt. Du gehört zwar nicht zu den Besten, aber wirst dich mit deinem Wissen auf dem Markt durchsetzen können. Herzlichen Glückwunsch.';

        const FIRST_FIELD_TEXT_FIC = 'Du hast als Bester präsentiert. Du bekommst die meisten Münzen. Herzlichen Glückwunsch!';
        const SECOND_FIELD_TEXT_FIC = 'Du hast zwar nicht als Bester präsentiert, aber du hast dich dennoch gut geschlagen. Du erhältst die restlichen Münzen.  Herzlichen Glückwunsch!';
        const THIRD_FIELD_TEXT_FIC = 'Deine Präsentation war nicht gerade die Beste. Ein Badankla war dennoch von deiner Präsentation überzeugt und gibt dir einige Münzen. Herzlichen Glückwunsch!';


        const TOO_MANY_STEPS_TEXT = 'Du musst das Ziel mit einer passenden Augenzahl erreichen!';
        const EMPTY_TEXT = 'Hier passiert nichts';

        const REAL_STORY_TEXT = "Liebe Studenten,\n" +
            "\n" +
            "ihr habt euch bei uns für eine Trainee Stelle beworben. Unser Unternehmen bietet dem besten Bewerber/der besten Bewerberin viele Möglichkeiten zur Entfaltung und im Anschluss einen fristlosen Arbeitsvertrag.\n" +
            "Unsere einzigen Bedingungen sind gute Note und vor allem ein selbstsicheres Auftreten.\n" +
            "Wir wünschen euch viel Erfolg in euren letzten Klausuren, mündlichen Prüfungen und Präsentationen, wir sehen uns zum Assessment Center, wenn wir alle eine Abschlussnote haben.\n" +
            "\n" +
            "Bis dahin und viele Grüße.";

        const FICTITIOUS_STORY_TEXT = "Liebe Badanklas,\n" +
            "\n" +
            "ihr habt alle tolle Vorhaben bei uns, dem großen Rat der Bedinklos, beantragt. Leider können wir nicht alle Vorhaben umsetzen. Deshalb haben wir beschlossen, das Vorhaben umzusetzen, dass uns am meisten überzeugt.\n" +
            "\n" +
            "Viel Erfolg euch!";

		const START_TEXT = "Herzlich Willkommen zum Serious Game by Moritz Rohde. Denken Sie nach dem Spiel an den Post Test. (Jeder Spieler) Der Link dazu ist unten auf dieser Seite. Viel Spaß! Klicken zum Fortfahren.";
			
		//Story texts real story
		const STORY_MELANIE_LORM_SHORT = "Ich bin die Melanie. Ich bin im 8. Semester und studiere Wirtschaftsinformatik.";

		const STORY_MARTIN_KIRTZ_SHORT  = "Ich bin der Martin und ich bin im 6. Semester und studiere Maschbau.";

		const STORY_JULIAN_KLAPP_SHORT  = "Ich bin der Julian und ich studiere Wirtschaftsinformatik. Ich bin im 5. Semester.";

		const STORY_NINA_KLAMM_SHORT  = "Ich bin die Nina und ich studiere Wirtschaftsingenieurwesen im 7. Semester.";

		//Story texts fictitious story

        const STORY_HUMPF_SHORT = "Ich bin der Humpf. Und ich habe Münzen beantragt, um den Ausbau der Himberrsträucher voranzutreiben.";

		const STORY_MUMTI_SHORT  = "Ich bin der Mumit. Und ich habe Münzen beantragt, um den Ausbau der Kiesstrände voranzutreiben.";

		const STORY_OPSTI_SHORT  = "Ich bin der Opsti. Und ich habe Münzen beantragt, um den Ausbau der Fabrik für unsichtbare Kugelschreiber voranzutreiben.\n";

		const STORY_WUMSTL_SHORT  = "Ich bin der Wumstl. Und ich habe Münzen beantragt, um den Ausbau der Fabrik für rote Turnbeutel voranzutreiben.";


			
			
        function preload () {
            try {


                //Load Characters - Monsters
                this.load.image('monster_red', './public/images/monster_red_mini.png');
                this.load.image('monster_green', './public/images/monster_green_mini.png');
                this.load.image('monster_lightgreen', './public/images/monster_lightgreen_mini.png');
                this.load.image('monster_purple', './public/images/monster_purple_mini.png');

                //load Characters - Students
                this.load.image('student_1', './public/images/woman_mini_1.png');
                this.load.image('student_2', './public/images/man_mini_1.png');
                this.load.image('student_3', './public/images/man_mini_2.png');
                this.load.image('student_4', './public/images/woman_mini_2.png');

                //Load game fields
                this.load.image('explode', './public/images/explode.png');
                this.load.image('lamp', './public/images/lamp.png');
                this.load.image('start', './public/images/start_field.png');
                this.load.image('goal', './public/images/goal_field.png');
                this.load.image('empty', './public/images/empty_field.png');

            } catch (e) {
                alert('Cant load an image');
                console.log('ERROR on image loading');
            }
        }

        function create () {
            this.cameras.main.backgroundColor.setTo(135, 206, 250);

            try {
                initFieldValues();
                initFieldTypes();
                initKnowledgeCards();
                initActionCardsReal();
                initActionCardsFictitious();

                generateGameBoard(this);

                //Load params
                loadParameters(this);

                initStoryText();
				initCardValue();
                nextPlayer();
                checkOverlappingAfter(25);

            } catch (e) {
                console.error('Error while drawing', e);
            }
        }

        class Character {

            constructor(name, player, field_nr) {
                this.name = name;
                this.player = player;
                this.field_nr = field_nr;
            }

        }


        function nextPlayer() {
            //Random player starts the game
            if (currentPlayerPos === -1)
                currentPlayerPos = parseInt(Math.random() * playerList.length, 10);

            currentPlayerPos++;
            if (currentPlayerPos >= playerList.length) {
                currentPlayerPos = 0;
            }

            currentPlayer = playerList[currentPlayerPos];
            document.getElementById('current_player_name_label').innerText = currentPlayer.name;
            beforeOverlapping = true;
        }



        function print_start_fields(game) {
            const start_field_bias = 50;
            const x_bias_left = 35;

            game.add.image(400, 400, 'start');
            draw_line(game, 400, 400 - start_field_bias, 400, 250);
            game.add.image(400, 250, 'explode');
            draw_line(game, 400 - x_bias_left, 250, var_print_x, var_print_y);
            game.add.image(var_print_x, var_print_y, 'empty');
        }

        function print_common_fields(game) {
            print_field(game, 'below', 'lamp');
            print_field(game, 'below', 'explode');
            print_field(game, 'below', 'lamp');
            print_field(game, 'right', 'explode');
            print_field(game, 'right', 'lamp');
            print_field(game, 'right', 'empty');
            print_field(game, 'above', 'explode');
            print_field(game, 'above', 'lamp');
            print_field(game, 'above', 'explode');
            print_field(game, 'above', 'lamp');
            print_field(game, 'left', 'explode');
            print_field(game, 'left', 'empty');
            print_field(game, 'left', 'lamp');
            print_field(game, 'left', 'lamp');
            print_field(game, 'below', 'lamp');
            print_field(game, 'below', 'explode');
            print_field(game, 'below', 'lamp');
            print_field(game, 'below', 'empty');
            print_field(game, 'below', 'explode');
            print_field(game, 'right', 'lamp');
            print_field(game, 'right', 'explode');
            print_field(game, 'right', 'lamp');
            print_field(game, 'right', 'explode');
            print_field(game, 'right', 'empty');
            print_field(game, 'right', 'explode');
            print_field(game, 'above', 'lamp');
            print_field(game, 'above', 'explode');
            print_field(game, 'above', 'empty');
            print_field(game, 'above', 'lamp');
            print_field(game, 'above', 'explode');
            print_field(game, 'right', 'lamp');
            print_field(game, 'below', 'explode');
            print_field(game, 'below', 'lamp');
            print_field(game, 'below', 'lamp');
            print_field(game, 'below', 'empty');
            print_field(game, 'below', 'lamp');
            print_field(game, 'right', 'lamp');
            print_field(game, 'right', 'explode');
            print_field(game, 'above', 'explode');
            print_field(game, 'above', 'lamp');
            print_field(game, 'above', 'lamp');
        }

        function print_goal_field(game) {
            const y_bias_above = 35;
            const goal_pos_bias = 150;

            draw_line(game, var_print_x, var_print_y - y_bias_above, var_print_x, var_print_y - 100);
            game.add.image(var_print_x, var_print_y - goal_pos_bias, 'goal');
        }

        function generateGameBoard(game) {

            //Manual print first 3 fields
            print_start_fields(game);
            //Relational printing
            print_common_fields(game);
            //Manual print last field
            print_goal_field(game);

        }

        function initFieldValues() {
            gamefield_positions = JSON.parse('[{"pos_x":400,"pos_y":400},{"pos_x":400,"pos_y":250},' +
                '{"pos_x":250,"pos_y":250},{"pos_x":250,"pos_y":350},' +
                '{"pos_x":250,"pos_y":450},{"pos_x":250,"pos_y":550},{"pos_x":350,"pos_y":550},' +
                '{"pos_x":450,"pos_y":550},{"pos_x":550,"pos_y":550},{"pos_x":550,"pos_y":450},' +
                '{"pos_x":550,"pos_y":350},{"pos_x":550,"pos_y":250},{"pos_x":550,"pos_y":150},' +
                '{"pos_x":450,"pos_y":150},{"pos_x":350,"pos_y":150},{"pos_x":250,"pos_y":150},' +
                '{"pos_x":150,"pos_y":150},{"pos_x":150,"pos_y":250},{"pos_x":150,"pos_y":350},' +
                '{"pos_x":150,"pos_y":450},{"pos_x":150,"pos_y":550},{"pos_x":150,"pos_y":650},' +
                '{"pos_x":250,"pos_y":650},{"pos_x":350,"pos_y":650},{"pos_x":450,"pos_y":650},' +
                '{"pos_x":550,"pos_y":650},{"pos_x":650,"pos_y":650},{"pos_x":750,"pos_y":650},' +
                '{"pos_x":750,"pos_y":550},{"pos_x":750,"pos_y":450},{"pos_x":750,"pos_y":350},' +
                '{"pos_x":750,"pos_y":250},{"pos_x":750,"pos_y":150},{"pos_x":850,"pos_y":150},' +
                '{"pos_x":850,"pos_y":250},{"pos_x":850,"pos_y":350},{"pos_x":850,"pos_y":450},' +
                '{"pos_x":850,"pos_y":550},{"pos_x":850,"pos_y":650},{"pos_x":950,"pos_y":650},' +
                '{"pos_x":1050,"pos_y":650},{"pos_x":1050,"pos_y":550},{"pos_x":1050,"pos_y":450},' +
                '{"pos_x":1050,"pos_y":350}, {"pos_x":1050,"pos_y":200}]');

        }

        function initStoryText() {
            if (story_type === 'real') {
                document.getElementById('story_telling_p').innerText = REAL_STORY_TEXT;
            } else {
                document.getElementById('story_telling_p').innerText = FICTITIOUS_STORY_TEXT;

            }
        }

        function initFieldTypes() {
            /*
             * -1: Start field
             *  0: Empty field
             *  1: Knowledge field (lamp, yellow)
             *  2: Action field (explosion, orange)
             *  3: Goal field
             */
            gamefield_types = [-1, 2, 0, 1, 2, 1, 2, 1, 0, 2, 1, 2, 1, 2, 0, 1, 1, 1, 2, 1, 0, 2, 1, 2, 1, 2, 0, 2,
                1, 2, 0, 1, 2, 1, 2, 1, 1, 0, 1, 1, 2, 2, 1, 1, 3];
        }

        function initKnowledgeCards() {
            knowledge_cards = [
                "Ziele des Präsentierens sind Informieren und Überzeugen",
                "Informieren: dem Empfänger alle Informationen zur Hand geben, die er benötigt, " +
                    "um nach der Präsentation zur gewünschten Art aktiv zu werden",
                "Titel von beruflichen Präsentationen: dürfen Aussagen enthalten",
                "Titel von allgemeinen Präsentationen: sind meistens aneinander gereihte Stichworte",
                "Kommunikation ist die Übermittlung von Nachrichten vom Sender zum Empfänger.",
                "Ein möglicher Kanal zur Informationsübermittlung ist: akustisch (Stimme, Klang)",
                "Ein möglicher Kanal zur Informationsübermittlung ist: visuell (PPT, Mimik, Gestik)",
                "Ein möglicher Kanal zur Informationsübermittlung ist: taktil (Berührung, Demonstrationsobjekt)",
                "Wer eine Präsentation hält, spricht den Sender über mehrere Kanäle an.",
                "Ein möglicher Kanal zur Informationsübermittlung ist: olfaktorisch (Geruch, Geschmack)",
                "not to do: zu laut/leise reden",
                "not to do: zu überladene Präsentationen",
                "not to do: zu viele Folien",
                "to do: Raumgestaltung und -größe den Rahmenbedingungen anpassen",
                "Jede Nachricht hat vier Seiten: Sachinformation, Appell, Beziehungshinweis und Selbstkundgabe",
                "Prozess des Präsentierens: Strukturieren Formulieren Visualisieren Editieren Präsentieren",
                "Strukturieren: sowohl den Inhalt, als auch die Planung der Präsentation",
                "Formulieren: logisch strukturierte Argumente zu einer Geschichte verknüpfen",
                "Visualisieren: Informationen in ein Bild übersetzen",
                "Editieren: die Präsentation proben",
                "Präsentieren: der eigentliche Auftritt vor Publikum",
                "Bevor man mit einer Präsentation startet, sollte das Ziel der Präsentation klar sein",
                "1.\tDas Ziel der Präsentation kann mit folgenden Fragen geklärt werden:  Was sollen die Teilnehmer " +
                    "nach der Präsentation vom Thema wissen? Was sollen sie vom Thema halten? Was sollen sie tun?",
                "Präsentationen dürfen unterhaltsam sein. Dabei helfen Bilder und Anekdoten.",
                "Der Nutzen steht  vor der Unterhaltung.",
                "Erfolgreiche Präsentationen leben von der Interaktion mit dem Publikum.",
                "Zwei bis drei Minuten pro Folie reden.",
                "Präsentationsmedium: Flipchart",
                "Präsentationsmedium: Beamer-Präsentation",
                "•\tVorteile Beamer-Präsentation:  keine Folien ausdrucken Änderungen und Korrekturen\n" +
                    "sind bis zur letzten Minute möglich Einbindung von Musik und Video möglich.",
                "Nachteile Beamer-Präsentation:  Technikprobleme nicht spontan",
                "Präsentationsmedium: Overhead-Projektor",
                "Präsentationsmedium: Pinnwand",
                "Vorteil Pinnwand: Gut, wenn in Interaktion mit dem Publikum etwas erarbeitet werden soll.",
                "Präsentationsmedium: Tafel/Whiteboard",
                "Nachteile Tafel/Whiteboard:  unleserliche Schrift zeitgleich reden und schreiben Blickkontakt halten" +
                    " beim Schreiben schwierig",
                "Wovon hängt die Medienwahl ab?  Thema Raum Teilnehmer Medien Präsentierender Unterlagen"
            ];
        }
        
        function initActionCardsReal() {
            action_cards_real = JSON.parse('[' +
                '{"text": "Du hast vergessen die Gliederung deiner Abschluss- präsentation rechtzeitig abzugeben.' +
                ' Gehe zwei Schritte zurück und ziehe eine Wissenskarte.",' +
                ' "action": -2, "card": 1},' +
                '{"text":"Du hast früh genug angefangen dir Gedanken über den Aufbau deiner Abschlusspräsentation ' +
                'zu machen.' +
                ' Gehe drei Schritte vor.",' +
                ' "action": 3, "card": 0},' +
                '{"text":"Du probst deine Abschlusspräsentation nicht.' +
                ' Gehe einen Schritt zurück ' +
                'und ziehe eine Wissenskarte.", ' +
                '"action": -1, "card": 1},' +
                '{"text":"Du bist dir nicht ganz sicher, ob der rote Faden in deiner Präsentation zu erkennen ist.' +
                ' Deshalb hältst du die Präsentation vor ein paar Freunden.' +
                ' Gehe zwei Schritte vor.",' +
                ' "action": 2, "card": 0},' +
                '{"text":"Mit deiner Abschlusspräsentation fängst du erst am Abend vor dem Termin an. ' +
                'Gehe drei Schritte zurück und ziehe eine Wissenskarte.",' +
                ' "action": -3, "card": 1},' +
                '{"text":"Du hast früh genug damit angefangen für die Klausuren zu lernen.' +
                ' Gehe drei Schritte vor.",' +
                ' "action": 3, "card": 0},' +
                '{"text":"Du hast erst am Abend vor der Klausur angefangen zu lernen. ' +
                'Gehe drei Schritte zurück und ziehe eine Wissenskarte.", "action": -3, "card": 1},' +
                '{"text":"Du hast vergessen dich zu einer Klausur anzumelden.' +
                ' Gehe zurück zum Start und ziehe eine Wissenskarte.",' +
                ' "action": -100, "card": 1},' +
                '{"text":"Du verbringst den Vormittag lieber mit Lernen statt mit Ausschlafen. ' +
                'Gehe zwei Schritte vor.",' +
                ' "action": 2, "card": 0},' +
                '{"text":"Du schläfst lieber aus, anstelle zu lernen. ' +
                'Gehe zwei Schritte zurück und ziehe eine Wissenskarte.",' +
                ' "action": -2, "card": 1},' +
                '{"text":"Du vergisst deine Lernsachen in der Bib. ' +
                'Gehe einen Schritt zurück und ziehe eine Wissenskarte.",' +
                ' "action": -1, "card": 1},' +
                '{"text":"Du suchst dir rechtzeitig eine Lerngruppe, die du alle zwei Tage triffst. ' +
                'Gehe drei Schritte vor.",' +
                ' "action": 3, "card": 0},' +
                '{"text":"Deine Karteikarten sind drei Wochen vor der Klausur fertig.' +
                ' Gehe einen Schritt vor",' +
                ' "action": 1, "card": 0},' +
                '{"text":"Du planst lieber die Party nach deiner Abschlusspräsentation statt' +
                ' für die Abschusspräsentation vorzubereiten.' +
                ' Gehe zwei Schritte zurück und ziehe eine Wissenskarte.",' +
                ' "action": -2, "card": 1},' +
                '{"text":"Du hast während der Vorlesungszeit immer alle Übungsblätter behandelt.' +
                ' Gehe zwei Schritte vor.",' +
                ' "action": 2, "card": 0},' +
                '{"text":"Bei den Proben deiner Präsentation wirst du immer besser und besser.' +
                ' Gehe einen Schritt vor.",' +
                ' "action": 1, "card": 0},' +
                '{"text":"Du bist davon überzeugt, dass du deine Präsentation vorher nicht proben musst.' +
                ' Gehe einen Schritt zurück und ziehe eine Wissenskarte.", ' +
                '"action": -1, "card": 1},' +
                '{"text":"Leider hast du bei der Eingrenzung für die Klausur nicht aufgepasst. Dadurch hast du die' +
                ' falschen Inhalte gelernt.' +
                ' Gehe zwei Schritte zurück und ziehe eine Wissenskarte.",' +
                ' "action": -2, "card": 1},' +
                '{"text":"Du hast passende Bilder in deine Abschlusspräsentation eingebaut.' +
                ' Gehe einen Schritt vor.",' +
                ' "action": 1, "card": 0},' +
                '{"text":"Du machst dir Gedanken über die Anzahl der Folien in deiner Seminarpräsentation.' +
                ' Gehe einen Schritt vor.",' +
                ' "action": 1, "card": 0},' +
                '{"text":"Du fügst ganz willkürlich Folien in deine Abschlusspräsentation ein und ' +
                'zeigst einige der Folien nur wenige Sekunden lang.' +
                ' Gehe einen Schritt zurück und ziehe eine Wissenskarte.",' +
                ' "action": -1, "card": 1},' +
                '{"text":"Du machst eine Pause und gehst eine Runde joggen.' +
                ' Gehe einen Schritt vor.",' +
                ' "action": 1, "card": 0},' +
                '{"text":"Du machst eine Pause und zockst drei Stunden lang Computerspiele.' +
                ' Danach lohnt sich das Lernen auch nicht mehr.' +
                ' Gehe zwei Schritte zurück und ziehe eine Wissenskarte.",' +
                ' "action": -2, "card": 1},' +
                '{"text":"Deine Abschlusspräsentation ist eine Woche vorher fertig.' +
                ' Du hast genug Zeit sie Korrekturlesen zu lassen.' +
                ' Gehe einen Schritt vor.", "action": 1, "card": 0},' +
                '{"text":"Du kommst ausgeschlafen und ausgeruht zur Abschlusspräsentation. ' +
                'Gehe einen Schritt vor.", "action": 1, "card": 0},' +
                '{"text":"Am Abend vor der Abschlusspräsentation gehst du in die ' +
                'Mitternachtspremiere des neuen Star Wars Films. ' +
                'Gehe einen Schritt zurück und ziehe eine Wissenskarte.",' +
                ' "action": -1, "card": 1}' +
                ']');
        }

        function initActionCardsFictitious() {
            action_cards_fictitious = JSON.parse('[' +
                '{"text":"Die restlichen Badanklas lachen dich hinter deinem Rücken für deine Präsentationen aus.' +
                ' Gehe zwei Schritte zurück und ziehe eine Wissenskarte",' +
                ' "action": -2, "card": 1},' +
                '{"text":"Die Präsentation lässt du von deinem Badankla-Azubi erstellen und probst sie vorher nicht.' +
                ' Gehe zwei Schritte zurück und ziehe eine Wissenskarte.",' +
                ' "action": -2, "card": 1},' +
                '{"text":"Du engagierst einen Privatlehrer, der mit dir das Präsentieren übt. ' +
                'Gehe drei Schritte vor.", ' +
                '"action": 3, "card": 0},' +
                '{"text":"Bei einem wichtigen Fernsehauftritt, wo öffentlich eure Ideen vorgestellt werden,' +
                ' kannst du das Ziel deiner Präsentation nicht klar darstellen. Die Zuschauer sind verwirrt.' +
                ' Gehe einen Schritt zurück und ziehe eine Wissenskarte.", "action": -1, "card": 1},' +
                '{"text":"Der rote Faden ist in deiner Präsentation nicht erkennbar. ' +
                'Gehe einen Schritt zurück und ziehe eine Wissenskarte.",' +
                ' "action": -1, "card": 1},' +
                '{"text":"Dem Rat der großen Bedinklos wird nicht klar, warum du die Münzen benötigst.' +
                ' Gehe einen Schritt zurück und ziehe eine Wissenskarte.", "action": -1, "card": 1},' +
                '{"text":"Du probst die Präsentation vor deinen Badankla-Freunden und ' +
                'nimmst Verbesserungsvorschläge entgegen.' +
                ' Gehe zwei Schritte vor.",' +
                ' "action": 2, "card": 0},' +
                '{"text":"Du untermauerst deine Argumente mit aussagekräftigen Bildern.' +
                ' Gehe einen Schritt vor.",' +
                ' "action": 1, "card": 0},' +
                '{"text":"Du gehst im Vorfeld schon mögliche Fragen des Rats der großen Bedinklos durch, ' +
                'damit du besser darauf vorbereitet bist. Gehe zwei Schritte vor.",' +
                ' "action": 2, "card": 0},' +
                '{"text":"Weil du die Präsentation so lange vor dir hergeschoben hast,' +
                ' hast du jetzt keine Zeit mehr mit aktuellen Zahlen zu arbeiten. ' +
                'Stattdessen musst du veraltete Werte zur Lage aus Bidinkli verwenden. ' +
                'Gehe zwei Schritte zurück und ziehe eine Wissenskarte.",' +
                ' "action": -2, "card": 1},' +
                '{"text":"Die Verbesserungsvorschläge deiner Badankla-Freunde akzeptierst du nicht.' +
                ' Gehe einen Schritt zurück und ziehe eine Wissenskarte.",' +
                ' "action": -1, "card": 1},' +
                '{"text":"Du wählst das Flipchart als Präsentationsmedium. ' +
                'Leider hast du vergessen, dass in dem Raum 150 Teilnehmer sitzen. Nur die Teilnehmer ' +
                'aus den vorderen Reihen können erahnen, was auf dem Flipchart steht.' +
                ' Gehe einen Schritt zurück und ziehe eine Wissenskarte.", "action": -1, "card": 1},' +
                '{"text":"Statt deine Präsentation zu üben, gehst du lieber mit einem Geschäftsmann-Badankla essen.' +
                ' Gehe einen Schritt zurück und ziehe eine Wissenskarte.", "action": -1, "card": 1},' +
                '{"text":"Statt deine Präsentation zu üben, überlegst du dir schon jetzt,' +
                ' wie du die positive Nachricht den Badanklas mitteilen wirst, ' +
                'damit deine Wahl in den Rat der großen Bedinklos gesichert ist. ' +
                'Gehe zwei Schritte zurück und ziehe eine Wissenskarte.", "action": -2, "card": 1},' +
                '{"text":"Die Argumente deiner Präsentation bauen aufeinander auf und sind schlüssig. ' +
                'Gehe zwei Schritte vor.",' +
                ' "action": 2, "card": 0},' +
                '{"text":"Weil du dich siegessicher fühlst, probst du deine Präsentation nicht. ' +
                'Gehe einen Schritt zurück und ziehe eine Wissenskarte.", "action": -1, "card": 1},' +
                '{"text":"Du glaubst nicht daran, dass du mit einer guten Präsentation die Münzen tatsächlich bekommen' +
                ' könntest, daher gibst du dir auch keine Mühe.' +
                ' Gehe einen Schritt zurück und ziehe eine Wissenskarte.",' +
                ' "action": -1, "card": 1},' +
                '{"text":"Du hast gehört, dass sich die anderen Badanklas seit Wochen auf ' +
                'ihre Präsentation vorbereiten. Du selbst hast immer noch nicht angefangen,' +
                ' obwohl es in zwei Tagen soweit ist.' +
                ' Gehe einen Schritt zurück und ziehe eine Wissenskarte.", "action": -1, "card": 1},' +
                '{"text":"Deine Badankla-Freunde sagen zu dir, dass du immer besser und besser präsentierst.' +
                ' Gehe zwei Schritte vor.",' +
                ' "action": 2, "card": 0},' +
                '{"text":"Du bist überzeugt davon, dass du mit einer guten Präsentation ' +
                'die wichtigen Münzen bekommen wirst. Deshalb gibst du dir sehr viel Mühe.' +
                ' Gehe einen Schritt vor.", "action": 1, "card": 0},' +
                '{"text":"Du weißt, dass du einen Presenter benötigst, vergisst ihn aber.' +
                ' Gehe einen Schritt zurück und ziehe eine Wissenskarte.",' +
                ' "action": -1, "card": 1},' +
                '{"text":"In deiner Recherche prüfst du, welche Badanklas in den vorherigen Jahren Münzgelder ' +
                'bekommen haben und warum.' +
                ' Gehe einen Schritt vor.",' +
                ' "action": 1, "card": 0},' +
                '{"text":"Je öfter du deine Präsentation übst, desto besser und selbstsicherer wirst du.' +
                ' Gehe einen Schritt vor.", "action": 1, "card": 0},' +
                '{"text":"Du hast Bilder in deiner Präsentation, die thematisch nicht passen. ' +
                'Gehe einen Schritt zurück und ziehe eine Wissenskarte.", "action": -1, "card": 1},' +
                '{"text":"Du hast versehentlich deine Präsentation gelöscht und hattest sie nicht woanders gespeichert.' +
                ' Gehe zurück zum Start.",' +
                ' "action": -100, "card": 0}' +
                ']');
        }
		
		function initCardValue() {
			document.getElementById(CARD_TEXT_ID).innerText = START_TEXT;
			checkCardTextPosition();
		}
		
		function checkCardTextPosition() {
			rect = document.getElementById(CARD_ID).getBoundingClientRect();
			document.getElementById(CARD_TEXT_ID).style.left = rect.x + 'px';
		}

		let story_shown_list = [];
		function showStory(id) {
		    story_hidden = true;
            try {


                let image = id.player.texture.key;
                for (let i = 0; i < story_shown_list.length; i++) {
                    if (image === story_shown_list[i]) {
                        //list contains id
                        return;
                    }
                }
                story_shown_list.push(image);


                document.getElementById(CARD_ID).src = getImage(image);

                let url = new URL(window.location.href);
                story_type = url.searchParams.get("type");

                if (story_type === 'real') {
                    switch (image) {
                        case 'student_1':
                            document.getElementById(CARD_TEXT_ID).innerText = STORY_MELANIE_LORM_SHORT;
                            break;
                        case 'student_2':
                            document.getElementById(CARD_TEXT_ID).innerText = STORY_MARTIN_KIRTZ_SHORT;
                            break;
                        case 'student_3':
                            document.getElementById(CARD_TEXT_ID).innerText = STORY_JULIAN_KLAPP_SHORT;
                            break;
                        case 'student_4':
                            document.getElementById(CARD_TEXT_ID).innerText = STORY_NINA_KLAMM_SHORT;
                            break;
                        default:
                            return null;
                    }
                } else {
                    switch (image) {
                        case 'monster_red':
                            document.getElementById(CARD_TEXT_ID).innerText = STORY_HUMPF_SHORT;
                            break;
                        case 'monster_green':
                            document.getElementById(CARD_TEXT_ID).innerText = STORY_MUMTI_SHORT;
                            break;
                        case 'monster_lightgreen':
                            document.getElementById(CARD_TEXT_ID).innerText = STORY_OPSTI_SHORT;
                            break;
                        case 'monster_purple':
                            document.getElementById(CARD_TEXT_ID).innerText = STORY_WUMSTL_SHORT;
                            break;
                        default:
                            return null;
                    }
                }
                document.getElementById(CARD_TEXT_ID).innerText += '\nKlicke nun auf den Würfel.';
                //document.getElementById(CARD_ID).src = EMPTY_FIELD_IMG;

            } catch (e) {
                console.log(e);
            }
        }
        function getImage(name) {
            let url = new URL(window.location.href);
            story_type = url.searchParams.get("type");

            let output = './public/images/';
            if (story_type === 'real') {
                switch (name) {
                    case 'student_1': output += 'woman_1';break;
                    case 'student_2': output += 'man_1';break;
                    case 'student_3': output += 'man_2';break;
                    case 'student_4': output += 'woman_2';break;
                    default: return null;
                }
            } else {
                output += name;
            }

            return output + '.png';

        }



        /** Draw an image related to last printed image position
         *
         * @param game Game to print on
         * @param mode Direction of line and related new position direction
         * @param image Image to print
         */
        function print_field(game, mode, image) {
            let old_x = var_print_x;
            let old_y = var_print_y;

            const y_bias_below = 32;
            const y_bias_above = 35;
            const x_bias_left = 35;
            const x_bias_right = 33;
            const circle_distance = 100;

            switch (mode) {
                case 'below':
                    var_print_y += circle_distance;
                    old_y += y_bias_below;
                    break;
                case 'above':
                    var_print_y -= circle_distance;
                    old_y -= y_bias_above;
                    break;
                case 'left':
                    var_print_x -= circle_distance;
                    old_x -= x_bias_left;
                    break;
                case 'right':
                    var_print_x += circle_distance;
                    old_x += x_bias_right;
                    break;
                default:
                    break;
            }
            draw_line(game, old_x, old_y, var_print_x, var_print_y);
            game.add.image(var_print_x, var_print_y, image);
        }

        /** Drawing a line from point A to point B
         *
         * @param game Game to print on
         * @param x1 1st point x position
         * @param y1 1st point y position
         * @param x2 2nd point x position
         * @param y2 2nd point y position
         */
        function draw_line(game, x1, y1, x2, y2) {
            let bias = 3;
            var graphics = game.add.graphics({ lineStyle: { width: 2, color: 0x000000 } });
            var line = new Phaser.Geom.Line(x1 - bias, y1, x2 - bias , y2);
            graphics.strokeLineShape(line);
        }

        //Is the cube currently rolling
        let roll = false;
        const TIME_OF_ROLLING_CUBE = 1500;
        async function  roll_the_dice() {
            if (!ready || roll || waitForAction || !story_hidden)  return;
            ignoreAction = false;
            let number = 0;
            roll = true;
            const start = Date.now();
            let random_time_delay = Math.random() * 1500;
            let dice_rolling_speed = 80;
            while (roll) {
                number += 1;
                if (number === 7) {
                    number = 1;
                }


                document.getElementById('cube_img').src = getDiceImage(number);
                await Sleep(dice_rolling_speed);
                dice_rolling_speed+=20;
                //Abbruch bedingung

                if (Date.now() > start + TIME_OF_ROLLING_CUBE + random_time_delay) {
                    roll = false;
                    steps = number;
                    currentPlayer.field_nr += 1;
                }
            }
        }

        function getDiceImage(number) {
            const BASE_PATH = './public/images/';
            switch (number) {
                case 1: return BASE_PATH + 'dice_one.png';
                case 2: return BASE_PATH + 'dice_two.png';
                case 3: return BASE_PATH + 'dice_three.png';
                case 4: return BASE_PATH + 'dice_four.png';
                case 5: return BASE_PATH + 'dice_five.png';
                case 6: return BASE_PATH + 'dice_six.png';
            }
        }

        //Game is finished variable
        let end = false;
        function update() {

            if (end) return;
			checkCardTextPosition();
            if (steps !== 0) {
                check_move_states();
            }
        }

        let waitForAction = false;
        let beforeOverlapping = true;
        function check_move_states() {

            if (waitForAction) return;

            //Würfelzahl ist zu groß, da passend ins Ziel gegangen werden soll

            if (currentPlayer.field_nr + steps > gamefield_types.length) {
                //Reset moving init
                currentPlayer.field_nr--;
                steps = 0;
                document.getElementById(CARD_TEXT_ID).innerText = TOO_MANY_STEPS_TEXT;
                document.getElementById(CARD_ID).src = EMPTY_FIELD_IMG;
                nextPlayer();
                ready = true;
                return;
            }

            if (beforeOverlapping) {
                checkOverlappingBefore();
                beforeOverlapping = false;
            }

            ready = false;

            //Start field pos check
            if (currentPlayer.field_nr < 0) {
                currentPlayer.field_nr = 0;
                ignoreAction = false;
            }

            let pos_tupel = calculateNewField(currentPlayer.field_nr);

            let stop_value_x = pos_tupel.pos_x;
            let stop_value_y = pos_tupel.pos_y;
            const SPEED = 10;

            let direction = calculateDirection(currentPlayer.player.x, currentPlayer.player.y, stop_value_x, stop_value_y);
            move(direction, stop_value_x, stop_value_y, SPEED);

        }

        function move(direction, stop_value_x, stop_value_y, speed) {
            switch (direction) {
                case 'up':
                    if (currentPlayer.player.y !== stop_value_y) {
                        currentPlayer.player.y -= speed;
                        checkLastMove(currentPlayer.player.y, stop_value_y);
                    }
                    break;
                case 'down':
                    if (currentPlayer.player.y !== stop_value_y) {
                        currentPlayer.player.y += speed;
                        checkLastMove(currentPlayer.player.y, stop_value_y);
                    }
                    break;
                case 'left':
                    if (currentPlayer.player.x !== stop_value_x) {
                        currentPlayer.player.x -= speed;
                        checkLastMove(currentPlayer.player.x, stop_value_x);
                    }
                    break;
                case 'right':
                    if (currentPlayer.player.x !== stop_value_x) {
                        currentPlayer.player.x += speed;
                        checkLastMove(currentPlayer.player.x, stop_value_x);
                    }
                    break;
                default:
                    break;
            }
        }

        function checkOverlappingBefore() {
            let pos_tupel = calculateNewField(currentPlayer.field_nr - 1);
            currentPlayer.player.x = pos_tupel.pos_x;
            currentPlayer.player.y = pos_tupel.pos_y;
        }

         function checkLastMove(value1, value2) {
            //if last check_move_states
            if (value1 === value2) {
                if (currentPlayer.field_nr === 0) {
                    steps = 0;
                }
                //Reset Shift variables
                active_x_shift = false;
                active_y_shift = false;

                // Are steps left?
                if (steps > 0) {
                    steps--;
                    if (steps > 0) currentPlayer.field_nr++;
                } else if (steps < 0) {
                    steps++;
                    if (steps < 0) currentPlayer.field_nr--;
                }
                if (steps === 0) {
                    checkWin();
                    setImageAndText();

                    if (!waitForAction) {
                        nextPlayer();
                    }

                    checkOverlappingAfter(20);

                    ready = true;
                }
            }
        }

        function checkOverlappingAfter(diff) {


            let move_list = [];
            for(let i = 0; i < playerList.length; i++) {
                for (let j = 0; j < playerList.length; j++) {
                    if (i === j) continue;
                    if (playerList[i].field_nr === playerList[j].field_nr) {
                        if (!move_list.includes(playerList[i]))
                            move_list.push(playerList[i]);
                        if (!move_list.includes(playerList[j]))
                            move_list.push(playerList[j]);
                    }
                }
            }

            let count = 0;


            move_list.forEach( (player) => {
                let pos_tupel = calculateNewField(player.field_nr);
                let new_x = pos_tupel.pos_x;
                let new_y = pos_tupel.pos_y;


                switch (count) {
                    case 0: new_x -= diff;
                        break;
                    case 1: new_x += diff;
                        break;
                    case 2: new_y += diff;
                        break;
                    case 3: new_y -= diff;
                        break;
                }

                player.player.x = new_x;
                player.player.y = new_y;
                count++;
            });

        }

        let winner = '';
        function checkWin() {

            if (gamefield_types[currentPlayer.field_nr] === 3) {
                if (winner === '') {
                    winner = currentPlayer.name;
                }

                //Remove player from Player Pool


                for (let i = 0; i < playerList.length; i++) {
                    if (currentPlayer === playerList[i]) {
                        playerList.splice(i, 1);
                        winnerList.push(currentPlayer);
                    }
                }

                const GOAL_POS_X = 1050;
                const GOAL_POS_Y = 200;
                const OFFSET = 30;

                switch (playerList.length) {

                    case 3:
                        currentPlayer.player.x = GOAL_POS_X - OFFSET;
                        currentPlayer.player.y = GOAL_POS_Y;
                        break;
                    case 2:
                        currentPlayer.player.x = GOAL_POS_X + OFFSET;
                        currentPlayer.player.y = GOAL_POS_Y;
                        break;
                    case 1:
                        currentPlayer.player.x = GOAL_POS_X;
                        currentPlayer.player.y = GOAL_POS_Y - OFFSET;
                        break;
                    default:
                        alert('ERROR');
                }

                //Game is finished when just one last player has not reached the goal
                if (playerList.length === 1) {
                    end = true;
                    alert('Das Spiel ist zu Ende! ' + winner + " hat das Spiel gewonnen. Bitte füllen Sie nun den Post Test aus. Danke für's Spielen!! \nUmfrage: https://www.survio.com/survey/d/F2O3Y8A4F8W3G2C3V \nOder unten auf dieser Seite");
                    document.getElementById('cube_img').onclick = '';
                    
                }
            }
        }

        let currentActionCard;

        const GIF_DURATION = 1500;
         function setImageAndText() {
            let type = gamefield_types[currentPlayer.field_nr];

            switch (type) {
                case -1:
                    break;
                case 0:
                    //Ignore action when reaching field with card action
                    if (ignoreAction) {
                        ignoreAction = false;
                        break;
                    }
                    // Reset card and text
                    document.getElementById(CARD_ID).src = EMPTY_FIELD_IMG;
                    document.getElementById(CARD_TEXT_ID).innerText = 'Leeres Feld:\n' + EMPTY_TEXT;


                    if (story_shown_list.length < playerList.length && winnerList.length === 0) {
                        showStoryCard = true;
                        story_hidden = false;
                        document.getElementById(CARD_TEXT_ID).innerText += '\nKlicken zum Fortfahren';

                    }

                    break;
                case 1:
                    //Ignore action when reaching field with card action
                    if (ignoreAction) {
                        ignoreAction = false;
                        break;
                    }

                    // Set card and text to knowledge theme
                    // Choose random knowledge phrase
                    document.getElementById(CARD_ID).src = KNOWLEDGE_GIF_FROZEN;
                    document.getElementById(CARD_TEXT_ID).innerText = 'Wissenskarte:\n' + getKnowledgeText();


                    if (story_shown_list.length < playerList.length && winnerList.length === 0) {
                        showStoryCard2 = true;
                        story_hidden = false;
                        document.getElementById(CARD_TEXT_ID).innerText += '\nKlicken zum Fortfahren';

                    }

                    break;
                case 2:
                    //Ignore action when reaching field with card action
                    if (ignoreAction) {
                        ignoreAction = false;
                        break;
                    }

                    let action_card = getActionText();
                    document.getElementById(CARD_ID).src = ACTION_GIF_FROZEN;
                    document.getElementById(CARD_TEXT_ID).innerText = 'Aktionskarte:\n' +action_card.text + '\nKlicken zum Fortfahren';

                    waitForAction = true;
                    executed = false;
                    currentActionCard = action_card;

                    if (story_shown_list.length < playerList.length && winnerList.length === 0) {
                        showStoryCard = true;
                        story_hidden = false;
                    }
                    break;
                case 3:
                    document.getElementById(CARD_TEXT_ID).innerText = getFinishText(winnerList.length);
                    switch (winnerList.length) {
                        case 1:
                            document.getElementById(CARD_ID).src = FIRST_IMAGE;

                            break;
                        case 2:
                            document.getElementById(CARD_ID).src = SECOND_IMAGE;
                            break;
                        case 3:
                            document.getElementById(CARD_ID).src = THIRD_IMAGE;
                            break;
                    }
                    break;
                default:
                    break;
            }
        }

        function getFinishText(number) {
            if (story_type === 'real') {
                switch (number) {
                    case 1: return FIRST_FIELD_TEXT_REAL;
                    case 2: return SECOND_FIELD_TEXT_REAL;
                    case 3: return THIRD_FIELD_TEXT_REAL;
                }
            } else {
                switch (number) {
                    case 1: return FIRST_FIELD_TEXT_FIC;
                    case 2: return SECOND_FIELD_TEXT_FIC;
                    case 3: return THIRD_FIELD_TEXT_FIC;
                }
            }
        }
        function getKnowledgeText() {
            let random_nr = Math.floor(Math.random() * knowledge_cards.length);
            let card = knowledge_cards[random_nr];
            removeElement(knowledge_cards, random_nr);
            return card;
        }

        function getActionText() {
            let text;
            if (story_type === 'real') {
                let random_nr = Math.floor(Math.random() * action_cards_real.length);
                text = action_cards_real[random_nr];
                removeElement(action_cards_real, random_nr)
            } else {
                //Story is fictitious
                let random_nr = Math.floor(Math.random() * action_cards_fictitious.length);
                text = action_cards_fictitious[random_nr];
                removeElement(action_cards_fictitious, random_nr);
            }
            return text
        }
        function removeElement(list, index) {
            for( let i = 0; i < list.length; i++){
                if ( i === index) {
                    list.splice(i, 1);
                }
            }
            return list;
        }

        function calculateNewField(nr) {
            if (nr < 0) nr = 0;
            currentPlayer.player.field_nr = 0;
            return gamefield_positions[nr];
        }

        //Vars to execute a full check_move_states and then reevaluate the direction of the movement
        let active_y_shift = false;
        let active_x_shift = false;
        function calculateDirection(pos_x, pos_y, stop_value_x, stop_value_y) {
            let diff_x = Math.abs(pos_x - stop_value_x);
            let diff_y = Math.abs(pos_y - stop_value_y);

            if (active_y_shift) return check_Y_Shift(pos_y, stop_value_y);
            if (active_x_shift) return check_X_Shift(pos_x, stop_value_x);

            if (diff_x >= diff_y) {
                active_x_shift = true;
                return check_X_Shift(pos_x, stop_value_x);
            } else if (diff_x < diff_y) {
                active_y_shift = true;
                return check_Y_Shift(pos_y, stop_value_y);

            }
            return 'no action';
        }

        function check_X_Shift(pos_x, stop_value_x) {
            if (pos_x > stop_value_x) {
                return 'left';
            } else if (pos_x < stop_value_x) {
                return 'right';
            }

            return 'no action';
        }

        function check_Y_Shift(pos_y, stop_value_y) {
            if (pos_y > stop_value_y) {
                return 'up';
            } else if (pos_y < stop_value_y) {
                return 'down';
            }

            return 'no action';
        }

        function Sleep(milliseconds) {
            return new Promise(resolve => setTimeout(resolve, milliseconds));
        }

        //Var that the fields action of the next check_move_states is ignored
        let ignoreAction = false;
        let executed = true;
        let showStoryCard = true;
        let showStoryCard2 = true;
         function executeCardAction(action_card) {

                 if (showStoryCard && executed || showStoryCard2) {
                     showStory(currentPlayer);
                     showStoryCard = false;
                     showStoryCard2 = false;
                     story_hidden = true;
                     return;
                 }
                 if (action_card === undefined || executed) return;
                 steps = action_card.action;


                 //Go forward card
                 if (steps > 0) currentPlayer.field_nr++;
                 //Go back card
                 if (steps < 0) currentPlayer.field_nr--;

                 //New science card
                 if (action_card.card === 1) {
                     document.getElementById(CARD_TEXT_ID).innerText = getKnowledgeText();
                     document.getElementById(CARD_ID).src = KNOWLEDGE_GIF_FROZEN;
                 } else {
                     document.getElementById(CARD_TEXT_ID).innerText = '';
                 }

                 ignoreAction = true;
                 waitForAction = false;
                 executed = true;


             if (story_shown_list.length < playerList.length && winnerList.length === 0) {
                     showStoryCard2 = true;
                     story_hidden = false;
                     document.getElementById(CARD_TEXT_ID).innerText += '\nKlicken zum Fortfahren';
                 }



         }

        function toGoal(num) {
            steps = +num;
            currentPlayer.field_nr++;
        }

        /** Loading game Parameters from URL
         *  including game type, player names and playes images
         * @param game
         */
        function loadParameters(game) {
            try {
                let url = new URL(window.location.href);
                //Story type
                story_type = url.searchParams.get("type");

                let player_url_list = [];
                //Player1
                let player_url_1 = url.searchParams.get("0");
                player_url_list.push(player_url_1);

                //Player2
                let player_url_2 = url.searchParams.get("1");
                player_url_list.push(player_url_2);

                //Player3
                let player_url_3 = url.searchParams.get("2");
                player_url_list.push(player_url_3);

                //Player4
                let player_url_4 = url.searchParams.get("3");
                player_url_list.push(player_url_4);

                let i = 0;
                for (i in player_url_list) {
                    if (player_url_list[i] != null) {
                        let json_player = JSON.parse(player_url_list[i]);
                        playerList.push(createGameCharacters(game, json_player.name, json_player.image));
                    }
                }

            } catch (e) {
                console.log(e);
            }
        }

        function createGameCharacters(game, name, image) {
            let player = game.add.sprite(400,400, image);
            return new Character(name, player, 0);

        }

        let story_hidden = false;
        function hide_story_text() {
            document.getElementById('story_telling_div').style.visibility = 'hidden';
        }

    </script>

</body>
</html>