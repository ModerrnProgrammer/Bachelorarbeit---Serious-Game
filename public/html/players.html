<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Characters</title>
    <link rel="stylesheet" type="text/css" href="public/stylesheets/players_style.css">

    <script>
        let selected_char = "";
        let players_list = [];
        let players_name_list = [];

        //Story texts real story
        const STORY_MELANIE_LORM = "Es ist das Jahr 2020 in Deutschland.\n" +
            "\n" +
            "Du bist Melanie Lorm und Bachelorstudentin Wirtschaftsinformatik im 8. Semester an der TU Braunschweig. In den letzten Wochen bestand dein Tagesablauf hauptsächlich aus Bachelorarbeit schreiben, Freunde treffen, chillen und vor allem Feiern. Du bist inzwischen in den letzten Zügen deiner Bachelorarbeit und wünscht dir immer mehr, möglichst schnell in das Berufsleben zu starten und endlich dein erstes eigenes Geld verdienen. Ganz zu schweigen davon, nie wieder eine Klausur oder Abschlussarbeit schreiben zu müssen.\n" +
            "\n" +
            "Vor einigen Tagen hast du gehört, dass eine Trainee Stelle in einem großen Unternehmen in deiner Gegend frei geworden ist. Von einer solchen Chance hast du schon lange geträumt. Um diese Stelle zu bekommen, musst du allerdings einen guten Notenschnitt nachweisen. Dabei bieten sich die letzten Klausuren, Seminarpräsentationen, mündlichen Prüfungen und das Kolloquium mit der Abschlusspräsentation an, um deinen Schnitt zu heben und dich deinem Ziel zu nähern. Da du in der Vergangenheit jedoch nie gut im Präsentieren gewesen bist und diese Chance nicht vergeigen willst, musst du jetzt alles geben, um dich fit zum Präsentieren zu machen.\n" +
            "\n" +
            "Deine Aufgabe ist es, dich so schnell wie möglich fit für die Abschlusspräsentation zu machen. Du hast gehört, dass die anderen Bewerber für die Traineestelle ähnliche Schwierigkeiten mit dem Präsentieren haben, sodass es jetzt nur noch darum geht, so schnell wie möglich eine perfekte Präsentation abzuhalten.\n" +
            "\n" +
            "Wenn du als erster vor den anderen Bewerbern mit einer überzeugenden Abschlusspräsentation für dich punkten kannst, wirst du deine lang erträumte Traumstelle erhalten.\n" +
            "\n" +
            "[Gelange so schnell wie möglich vom Start aus bis zum Ziel. Versuche dabei jeden Hinweis, den du (oder ein Mitspieler) während des Spiels zum Präsentieren erhältst, zu erlernen. Mit deinen neuen Fähigkeiten wirst du nachher hervorragend präsentieren]\n" +
            "\n" +
            "Viel Erfolg.\n";
        const STORY_MARTIN_KIRTZ = "Es ist das Jahr 2020 in Deutschland.\n" +
            "\n" +
            "Du bist Martin Kirtz und Bachelorstudent Maschinenbau im 6. Semester an der TU Braunschweig. In den letzten Wochen bestand dein Tagesablauf hauptsächlich aus Bachelorarbeit schreiben, Freunde treffen, chillen und vor allem Feiern. Du bist inzwischen in den letzten Zügen deiner Bachelorarbeit und wünscht dir immer mehr, möglichst schnell in das Berufsleben zu starten und endlich dein erstes eigenes Geld verdienen. Ganz zu schweigen davon, nie wieder eine Klausur oder Abschlussarbeit schreiben zu müssen.\n" +
            "\n" +
            "Vor einigen Tagen hast du gehört, dass eine Trainee Stelle in einem großen Unternehmen in deiner Gegend frei geworden ist. Von einer solchen Chance hast du schon lange geträumt. Um diese Stelle zu bekommen, musst du allerdings einen guten Notenschnitt nachweisen. Dabei bieten sich die letzten Klausuren, Seminarpräsentationen, mündlichen Prüfungen und das Kolloquium mit der Abschlusspräsentation an, um deinen Schnitt zu heben und dich deinem Ziel zu nähern. Da du in der Vergangenheit jedoch nie gut im Präsentieren gewesen bist und diese Chance nicht vergeigen willst, musst du jetzt alles geben, um dich fit zum Präsentieren zu machen.\n" +
            "\n" +
            "Deine Aufgabe ist es, dich so schnell wie möglich fit für die Abschlusspräsentation zu machen. Du hast gehört, dass die anderen Bewerber für die Traineestelle ähnliche Schwierigkeiten mit dem Präsentieren haben, sodass es jetzt nur noch darum geht, so schnell wie möglich eine perfekte Präsentation abzuhalten.\n" +
            "\n" +
            "Wenn du als erster vor den anderen Bewerbern mit einer überzeugenden Abschlusspräsentation für dich punkten kannst, wirst du deine lang erträumte Traumstelle erhalten.\n" +
            "\n" +
            "[Gelange so schnell wie möglich vom Start aus bis zum Ziel. Versuche dabei jeden Hinweis, den du (oder ein Mitspieler) während des Spiels zum Präsentieren erhältst, zu erlernen. Mit deinen neuen Fähigkeiten wirst du nachher hervorragend präsentieren]\n" +
            "\n" +
            "Viel Erfolg.\n";
        const STORY_JULIAN_KLAPP = "Es ist das Jahr 2020 in Deutschland.\n" +
            "\n" +
            "Du bist Julian Lapp und Bachelorstudent Wirtschaftsinformatik im 5. Semester an der TU Braunschweig. In den letzten Wochen bestand dein Tagesablauf hauptsächlich aus Bachelorarbeit schreiben, Freunde treffen, chillen und vor allem Feiern. Du bist inzwischen in den letzten Zügen deiner Bachelorarbeit und wünscht dir immer mehr, möglichst schnell in das Berufsleben zu starten und endlich dein erstes eigenes Geld verdienen. Ganz zu schweigen davon, nie wieder eine Klausur oder Abschlussarbeit schreiben zu müssen.\n" +
            "\n" +
            "Vor einigen Tagen hast du gehört, dass eine Trainee Stelle in einem großen Unternehmen in deiner Gegend frei geworden ist. Von einer solchen Chance hast du schon lange geträumt. Um diese Stelle zu bekommen, musst du allerdings einen guten Notenschnitt nachweisen. Dabei bieten sich die letzten Klausuren, Seminarpräsentationen, mündlichen Prüfungen und das Kolloquium mit der Abschlusspräsentation an, um deinen Schnitt zu heben und dich deinem Ziel zu nähern. Da du in der Vergangenheit jedoch nie gut im Präsentieren gewesen bist und diese Chance nicht vergeigen willst, musst du jetzt alles geben, um dich fit zum Präsentieren zu machen.\n" +
            "\n" +
            "Deine Aufgabe ist es, dich so schnell wie möglich fit für die Abschlusspräsentation zu machen. Du hast gehört, dass die anderen Bewerber für die Traineestelle ähnliche Schwierigkeiten mit dem Präsentieren haben, sodass es jetzt nur noch darum geht, so schnell wie möglich eine perfekte Präsentation abzuhalten.\n" +
            "\n" +
            "Wenn du als erster vor den anderen Bewerbern mit einer überzeugenden Abschlusspräsentation für dich punkten kannst, wirst du deine lang erträumte Traumstelle erhalten.\n" +
            "\n" +
            "[Gelange so schnell wie möglich vom Start aus bis zum Ziel. Versuche dabei jeden Hinweis, den du (oder ein Mitspieler) während des Spiels zum Präsentieren erhältst, zu erlernen. Mit deinen neuen Fähigkeiten wirst du nachher hervorragend präsentieren]\n" +
            "\n" +
            "Viel Erfolg.\n";
        const STORY_NINA_KLAMM = "Es ist das Jahr 2020 in Deutschland.\n" +
            "\n" +
            "Du bist Nina Klamm und Bachelorstudentin Wirtschaftsingenieurwesen im 7. Semester an der TU Braunschweig. In den letzten Wochen bestand dein Tagesablauf hauptsächlich aus Bachelorarbeit schreiben, Freunde treffen, chillen und vor allem Feiern. Du bist inzwischen in den letzten Zügen deiner Bachelorarbeit und wünscht dir immer mehr, möglichst schnell in das Berufsleben zu starten und endlich dein erstes eigenes Geld verdienen. Ganz zu schweigen davon, nie wieder eine Klausur oder Abschlussarbeit schreiben zu müssen.\n" +
            "\n" +
            "Vor einigen Tagen hast du gehört, dass eine Trainee Stelle in einem großen Unternehmen in deiner Gegend frei geworden ist. Von einer solchen Chance hast du schon lange geträumt. Um diese Stelle zu bekommen, musst du allerdings einen guten Notenschnitt nachweisen. Dabei bieten sich die letzten Klausuren, Seminarpräsentationen, mündlichen Prüfungen und das Kolloquium mit der Abschlusspräsentation an, um deinen Schnitt zu heben und dich deinem Ziel zu nähern. Da du in der Vergangenheit jedoch nie gut im Präsentieren gewesen bist und diese Chance nicht vergeigen willst, musst du jetzt alles geben, um dich fit zum Präsentieren zu machen.\n" +
            "\n" +
            "Deine Aufgabe ist es, dich so schnell wie möglich fit für die Abschlusspräsentation zu machen. Du hast gehört, dass die anderen Bewerber für die Traineestelle ähnliche Schwierigkeiten mit dem Präsentieren haben, sodass es jetzt nur noch darum geht, so schnell wie möglich eine perfekte Präsentation abzuhalten.\n" +
            "\n" +
            "Wenn du als erster vor den anderen Bewerbern mit einer überzeugenden Abschlusspräsentation für dich punkten kannst, wirst du deine lang erträumte Traumstelle erhalten.\n" +
            "\n" +
            "[Gelange so schnell wie möglich vom Start aus bis zum Ziel. Versuche dabei jeden Hinweis, den du (oder ein Mitspieler) während des Spiels zum Präsentieren erhältst, zu erlernen. Mit deinen neuen Fähigkeiten wirst du nachher hervorragend präsentieren]\n" +
            "\n" +
            "Viel Erfolg.\n";

        //Story texts fictitious story

        const STORY_HUMPF = "Es ist das Jahr 75x4 in Bidinkli.\n" +
            "\n" +
            "Du bist ein Badankla. Dein Name ist Humpf. Du hast Münzen beim Rat der großen Bedinklos beantragt, um den Ausbau der Himbeersträucher voranzutreiben. Himbeeren sind nämlich die Leibspeise der Balankas.\n" +
            "\n" +
            "Humpf, deine Aufgabe ist es, die notwendigen Münzen für dein Vorhaben vom Rat der großen Bedinklos zu erhalten. Allerdings sind die Münzen des Rats der großen Bedinklos begrenzt und du hast erfahren, dass weitere Badanklas Münzen für ihre Vorhaben beantragt haben. Du weißt, dass der Badankla, der sein Vorhaben am besten präsentieren wird, die Münzen erhält.\n" +
            "\n" +
            "Du weißt, dass du nicht die besten Präsentationen halten kannst. Deshalb ist das letzte Problem, das es für dich zu lösen gilt, die Verbesserung deiner Präsentationskompetenz, um den überzeugendsten Vortrag zu halten.\n" +
            "\n" +
            "[Gelange so schnell wie möglich vom Start aus bis zum Ziel. Versuche dabei jeden Hinweis, den du (oder ein Mitspieler) während des Spiels zum Präsentieren erhältst, zu erlernen. Mit deinen neuen Fähigkeiten wirst du nachher hervorragend präsentieren]\n" +
            "\n" +
            "Viel Erfolg, Humpf.\n";
        const STORY_MUMTI = "Es ist das Jahr 75x4 in Bidinkli.\n" +
            "\n" +
            "Du bist ein Badankla. Dein Name ist Mumit. Du hast Münzen beim Rat der großen Bedinklos beantragt, um den Ausbau der Kiesstrände voranzutreiben. An Kiesstränden rumzuliegen, ist nämlich das größte Hobby der Badanklas.\n" +
            "\n" +
            "Mumit, deine Aufgabe ist es, die notwendigen Münzen für dein Vorhaben vom Rat der großen Bedinklos zu erhalten. Allerdings sind die Münzen des Rats der großen Bedinklos begrenzt und du hast erfahren, dass weitere Badanklas Münzen für ihre Vorhaben beantragt haben. Du weißt, dass der Badankla, der sein Vorhaben am besten präsentieren wird, die Münzen erhält.\n" +
            "\n" +
            "Du weißt, dass du nicht die besten Präsentationen halten kannst. Deshalb ist das letzte Problem, das es für dich zu lösen gilt, die Verbesserung deiner Präsentationskompetenz, um den überzeugendsten Vortrag zu halten.\n" +
            "\n" +
            "[Gelange so schnell wie möglich vom Start aus bis zum Ziel. Versuche dabei jeden Hinweis, den du (oder ein Mitspieler) während des Spiels zum Präsentieren erhältst, zu erlernen. Mit deinen neuen Fähigkeiten wirst du nachher hervorragend präsentieren]\n" +
            "\n" +
            "Viel Erfolg, Mumit.\n";
        const STORY_OPSTI = "Es ist das Jahr 75x4 in Bidinkli.\n" +
            "\n" +
            "Du bist ein Badankla. Dein Name ist Opsti. Du hast Münzen beim Rat der großen Bedinklos beantragt, um den Ausbau der Fabrik für unsichtbare Kugelschreiber voranzutreiben. Unsichtbare Kugelschreiber sind nämlich die liebsten Stifte der Balankas.\n" +
            "\n" +
            "Opsti, deine Aufgabe ist es, die notwendigen Münzen für dein Vorhaben vom Rat der großen Bedinklos zu erhalten. Allerdings sind die Münzen des Rats der großen Bedinklos begrenzt und du hast erfahren, dass weitere Badanklas Münzen für ihre Vorhaben beantragt haben. Du weißt, dass der Badankla, der sein Vorhaben am besten präsentieren wird, die Münzen erhält.\n" +
            "\n" +
            "Du weißt, dass du nicht die besten Präsentationen halten kannst. Deshalb ist das letzte Problem, das es für dich zu lösen gilt, die Verbesserung deiner Präsentationskompetenz, um den überzeugendsten Vortrag zu halten.\n" +
            "\n" +
            "[Gelange so schnell wie möglich vom Start aus bis zum Ziel. Versuche dabei jeden Hinweis, den du (oder ein Mitspieler) während des Spiels zum Präsentieren erhältst, zu erlernen. Mit deinen neuen Fähigkeiten wirst du nachher hervorragend präsentieren]\n" +
            "\n" +
            "Viel Erfolg, Opsti.\n";
        const STORY_WUMSTL = "Es ist das Jahr 75x4 in Bidinkli. \n" +
            "\n" +
            "Du bist ein Badankla. Dein Name ist Wumstl. Du hast Münzen beim Rat der großen Bedinklos beantragt, um den Ausbau der Fabrik für rote Turnbeutel voranzutreiben. Rote Turnbeutel sind nämlich die liebsten Taschen der Balankas.\n" +
            "\n" +
            "Wumstl, deine Aufgabe ist es, die notwendigen Münzen für dein Vorhaben vom Rat der großen Bedinklos zu erhalten. Allerdings sind die Münzen des Rats der großen Bedinklos begrenzt und du hast erfahren, dass weitere Badanklas Münzen für ihre Vorhaben beantragt haben. Du weißt, dass der Badankla, der sein Vorhaben am besten präsentieren wird, die Münzen erhält.\n" +
            "\n" +
            "Du weißt, dass du nicht die besten Präsentationen halten kannst. Deshalb ist das letzte Problem, das es für dich zu lösen gilt, die Verbesserung deiner Präsentationskompetenz, um den überzeugendsten Vortrag zu halten. \n" +
            "\n" +
            "[Gelange so schnell wie möglich vom Start aus bis zum Ziel. Versuche dabei jeden Hinweis, den du (oder ein Mitspieler) während des Spiels zum Präsentieren erhältst, zu erlernen. Mit deinen neuen Fähigkeiten wirst du nachher hervorragend präsentieren.]\n" +
            "\n" +
            "Viel Erfolg, Wumstl.\n";

        const STORY_START_VALUE = "Wähle eine Figur aus um seine Geschichte zu erfahren.";

        function nextPlayer() {
            try {
                //Check if there is a char selected
                if (selected_char === '') {
                    alert('Bitte wählen Sie einen Charakter aus!');
                    return;
                }
				
                let name = getName(selected_char);


				
				
                //Check if name is already chosen
                let i = 0;


                for(i in players_name_list) {
                    if (players_name_list[i] === name) {
                        alert('Dieser Name ist bereits in der Spielerliste eingetragen. Wählen Sie bitte einen anderen.');
                        return;
                    }

                }
				
				//Change visibility of player list
				document.getElementById('created_players_div').style.display = 'block';

                players_list.push('{"name":"' + name + '", "image":"' + getImage(selected_char) + '"}');
                players_name_list.push(name);

                //Clear fields and add a gray filter
                document.getElementById(selected_char).style.filter = 'grayscale(0.9)';
                document.getElementById(selected_char).style.webkitFilter = 'grayscale(0.9)';
                document.getElementById(selected_char).style.background = "lightskyblue";
                document.getElementById(selected_char).onclick = '';
				document.getElementById(selected_char).className = '';

                //If max. 4 Players has been selected
                if (players_name_list.length === 4) {
                    document.getElementById('btn_start_game').style.background = "#f55";
                    document.getElementById('btn_next_player').disabled = true;
                    document.getElementById('character_story_div').style.display = 'none';
                    document.getElementById('new_char_div').style.display = 'none';
                }

                //Add player to interface
                let players_div = document.getElementById('created_players_div');
                players_div.style.visibility = 'visible';

                let div = document.createElement("div");

                let label = document.createElement("label");
                label.innerText = name;
                label.className = 'mini_player_name';

                let img = document.createElement('img');
                console.log(img.src = document.getElementById(selected_char).childNodes[1].childNodes[3].src);
                img.src = document.getElementById(selected_char).childNodes[1].childNodes[3].src;
                img.className = 'mini_image';

                div.appendChild(label);
                div.appendChild(img);

                players_div.appendChild(div);

                selected_char = '';
                document.getElementById('character_story_head').innerText = STORY_START_VALUE;
                document.getElementById('character_story_p').innerText = '';
            } catch (e) {
                console.log(e);
            }


        }

        function getName(id) {
            if (story_type === 'real') {
                switch (id) {
                    case 'img_div_1': return 'Melanie';
                    case 'img_div_2': return 'Martin';
                    case 'img_div_3': return 'Julian';
                    case 'img_div_4': return 'Nina';
                    default: return null;
                }
            } else {
                switch (id) {
                    case 'img_div_1': return 'Humpf';
                    case 'img_div_2': return 'Mumit';
                    case 'img_div_3': return 'Opsti';
                    case 'img_div_4': return 'Wumstl';
                    default: return null;
                }
            }
        }

        function startGame() {

            if (players_list.length < 2) {
                alert('Achtung! Das Spiel erfordert ein Minimum von zwei Spielern!');
                return;
            }
			
			if(confirm('Eingetragene Spieler: ' + players_name_list + '\nSind alle Spieler eingetragen?')) {
				
			

				let new_url = window.location.protocol + '//' + window.location.host + '/game';
				let old_url = new URL(window.location.href);


				let story_type = old_url.searchParams.get("type");
				const querystring = encodeQueryData(players_list);

				new_url = new_url + '?type=' + story_type + '&' + querystring;
				window.location.replace(new_url);
			} else {
				//Rote Markiertung geht nicht weg
			}
        }

        function selectImage(image) {
			let icons = document.getElementsByClassName('icon');

			//TODO: Bug
            for(let index = 0; index < icons.length; index++) {
                if (icons[index] === image.id || icons[index] === 'undefined' || icons[index] === null) continue;
                document.getElementById(icons[index].id).style.background = "";
            }
            document.getElementById(image.id).style.background = "#f00";
            selected_char = image.id;

            //set character text
            document.getElementById('character_story_p').innerText = getStoryDesc(image.id);
            document.getElementById('character_story_head').innerText = 'Das ist meine Geschichte:';
        }

        function getStoryDesc(id) {
            let url = new URL(window.location.href);
            story_type = url.searchParams.get("type");

            if (story_type === 'real') {
                switch (id) {
                    case 'img_div_1': return STORY_MELANIE_LORM;
                    case 'img_div_2': return STORY_MARTIN_KIRTZ;
                    case 'img_div_3': return STORY_JULIAN_KLAPP;
                    case 'img_div_4': return STORY_NINA_KLAMM;
                    default: return null;
                }
            } else {
                switch (id) {
                    case 'img_div_1': return STORY_HUMPF;
                    case 'img_div_2': return STORY_MUMTI;
                    case 'img_div_3': return STORY_OPSTI;
                    case 'img_div_4': return STORY_WUMSTL;
                    default: return null;
                }
            }
        }
        function encodeQueryData(data) {
            const ret = [];
            for (let d in data)
                ret.push(encodeURIComponent(d) + '=' + encodeURIComponent(data[d]));
            return ret.join('&');
        }


        function getImage(id) {
            let url = new URL(window.location.href);
            story_type = url.searchParams.get("type");

            if (story_type === 'real') {
                switch (id) {
                    case 'img_div_1': return 'student_1';
                    case 'img_div_2': return 'student_2';
                    case 'img_div_3': return 'student_3';
                    case 'img_div_4': return 'student_4';
                    default: return null;
                }
            } else {
                switch (id) {
                    case 'img_div_1': return 'monster_red';
                    case 'img_div_2': return 'monster_green';
                    case 'img_div_3': return 'monster_lightgreen';
                    case 'img_div_4': return 'monster_purple';
                    default: return null;
                }
            }



        }

        function initImages() {
            let url = new URL(window.location.href);
            let story_type = url.searchParams.get("type");
            if (story_type === 'real') {
                document.getElementById('image_1').src = './public/images/woman_1.png';
                document.getElementById('image_2').src = './public/images/man_1.png';
                document.getElementById('image_3').src = './public/images/man_2.png';
                document.getElementById('image_4').src = './public/images/woman_2.png';
                document.getElementById('label_1').innerHTML = 'Melanie Lorm ';
                document.getElementById('label_2').innerHTML = 'Martin Kirtz';
                document.getElementById('label_3').innerHTML = 'Julian Lapp';
                document.getElementById('label_4').innerHTML = 'Nina Klamm';
				
            } else {
                document.getElementById('image_1').src = './public/images/monster_red.png';
                document.getElementById('image_2').src = './public/images/monster_lightgreen.png';
                document.getElementById('image_3').src = './public/images/monster_green.png';
                document.getElementById('image_4').src = './public/images/monster_purple.png';
				document.getElementById('label_1').innerHTML = 'Humpf';
                document.getElementById('label_2').innerHTML = 'Mumit';
                document.getElementById('label_3').innerHTML = 'Opsti';
                document.getElementById('label_4').innerHTML = 'Wumstl';
            }

        }

    </script>
</head>
<body>

<div id="content">
    <div id="headline_div">
        <label id="players_headline">Spieler erstellen</label>
    </div>


    <div id="created_players_div">
        <p id='created_players_p'><b>Eingetragene Spieler:</b></p>
    </div>

    <div id="new_char_div">
        <div id="wrapper_images">
            <div class="icon" id="img_div_1" onclick="selectImage(this);">
                <div class="center_images_div">
                    <label id='label_1'></label>
                    <img id="image_1" class="choose_players_char" src="">
                </div>
            </div>
            <div class="icon" id="img_div_2" onclick="selectImage(this);">
                <div class="center_images_div">
                    <label id='label_2'></label>
                    <img id="image_2" class="choose_players_char" src="">
                </div>
            </div>
            <div class="icon" id="img_div_3" onclick="selectImage(this);">
                <div class="center_images_div">
                    <label id='label_3'></label>
                    <img id="image_3" class="choose_players_char" src="">
                </div>
            </div>
            <div class="icon" id="img_div_4" onclick="selectImage(this);">
                <div class="center_images_div">
                    <label id='label_4'></label>
                    <img id="image_4" class="choose_players_char" src="">
                </div>
            </div>
        </div>
    </div>

    <div id="character_story_div">
        <p id="character_story_head" style="font-size: 2rem"><b>Wähle eine Figur aus um seine Geschichte zu erfahren.</b></p>
            <p id="character_story_p"></p>
        </div>


    <div id="player_buttons">
        <button class="player_button" id="btn_next_player" onclick="nextPlayer()">Spieler eintragen</button>
        <button class="player_button" id="btn_start_game" onclick="startGame()">Spiel starten</button>
    </div>

</div>
</body>

<script>
    initImages();
</script>
</html>